<script>
    // Função para puxar API CPF/CNPJ e aplicar nos campos de viajante
    function apiCpf(){
            jQuery(document).ready(function($) {
            var token = "589b919a78706e51e72c5f5e60c01046"
            var urlBase = "https://api.cpfcnpj.com.br/";
            $("#form-field-cpf_viajante1").blur(function() {
                var cpf = $("#form-field-cpf_viajante").val().replace(/\D/g, '');
                if (cpf != "") {
                    var validacpf = /^[0-9]{11}$/;      
                    if(validacpf.test(cpf)) {
                        $("#form-field-nome_viajante1").val("...");
                        $("#form-field-data_nasc").val("...");
                        $.getJSON(urlBase + token +"/7/" + cpf , function(data) { 
                            $( '#billing_persontype option[value=1]' ).attr( 'selected', 'selected' ).change();
                            $("#form-field-nome_viajante1").val(data.nome);
                            var nomeAPI = data.nome;
                            var nomeCompleto = nomeAPI.split(" ");
                            var primeiroNome = nomeCompleto[0];
                            var sobrenomeArray = nomeCompleto.slice(1);
                            var sobrenome = sobrenomeArray.join(" ");
                            $("#form-field-nome_viajante1").val(data.nome);
                            $("#billing_nome_viajante1").val(data.nome);
                            $("#form-field-data_nasc").val(data.nascimento);
                            $("#billing_nasc_viajante1").val(data.nascimento);
                            $("#billing_first_name").val(primeiroNome);
                            $("#billing_last_name").val(sobrenome);
                            $("#billing_cpf").val(cpf);
                            
                            $("#billing_cpf_viajante1").val(cpf);
                        });
                    };
                }
            });
        });
    }

    // Função para puxar API CEP e aplicar nos campos de viajante
    function apiCep(){
        var estado;
        jQuery(document).ready(function($) {
            $( '#billing_state option:selected' ).attr( 'selected', false ).change();
            var urlBase = "https://viacep.com.br/ws/";
            $("#form-field-cep_viajante").blur(function() {
                var cep = $("#form-field-cep_viajante1").val().replace(/\D/g, '');
                if (cep != "") {
                    var validacep = /^[0-9]{8}$/;      
                    if(validacep.test(cep)) {
                        $("#form-field-endereco").val("...");
                        $("#form-field-end_cidade").val("...");
                        $("#form-field-end_bairro").val("...");
                        $("#form-field-end_estado").val("...");
                        $("#billing_postcode").val(cep);
                        $("#billing_cep_imovel").val(cep);
                        $.getJSON(urlBase + cep +"/json/?callback=?" , function(data) {            
                            $("#form-field-endereco").val(data.logradouro);
                            $("#billing_address_1").val(data.logradouro);
                            $("#billing_endereco_imovel").val(data.logradouro);
                            $("#form-field-end_bairro").val(data.bairro);
                            $("#billing_neighborhood").val(data.bairro);
                            $("#billing_bairro_imovel").val(data.bairro);
                            $("#form-field-end_cidade").val(data.localidade);
                            $("#billing_city").val(data.localidade);
                            $("#billing_cidade_imovel").val(data.localidade);
                            $("#form-field-end_estado").val(data.uf);
                            $("#billing_estado_imovel").val(data.uf);
                            estado = data.uf;
                            document.getElementById('billing_state').value = estado;
                            $( '#billing_state option[value='+ data.uf +']' ).attr( 'selected', 'selected' ).change();
                            console.log(data.uf);
                            $( '#billing_state' ).trigger( 'liszt:updated' ).trigger( 'chosen:updated' );
                        });
                    };
                }
            });
        });
    }

    // Função para puxar API Cotador Dólar
    function apiDolar() {
        var urlBase = "https://economia.awesomeapi.com.br/last";
        var moedas = "USD-BRL";
        jQuery(document).ready(function($) {
            $.getJSON( urlBase + "/" + moedas , function(data) {
                    var valorDolar = data["USDBRL"]["ask"];
                    $("#form-field-valor_dolar").val(valorDolar);
                    var dolarTradado = valorDolar.substring(0, valorDolar.length - 2);
                    var dolarVirgula = dolarTradado.replace(/[.]/g, ',');
                    $("#form-field-valor_dolar_virgula").val(dolarVirgula);
                });
            });
    }

    // Função para calculo da tarifa final
    var btnCotar
    window.setTimeout(function(){
    document.getElementById("btn-assinar").style.display = "none"
    btnCotar = document.querySelector("#btn-cotar")
    btnCotar.addEventListener("click", function(e){
        e.preventDefault
        calculaValorFinal()
        mostrarBotaoAssinar()
    })

    function calculaValorFinal(){
    var diasViagem = document.getElementById("form-field-diasVigem").value
    var cotacaoDolar = document.getElementById("form-field-valor_dolar").value
    var valorPlanoDia0 = document.getElementById("form-field-plano-0").checked
    var valorPlanoDia1 = document.getElementById("form-field-plano-1").checked
    
    const menor65 = []
    const maior65 = []
    var idades = document.querySelectorAll("#form-field-idadeViaj1, #form-field-idadeViaj2, #form-field-idadeViaj3, #form-field-idadeViaj4, #form-field-idadeViaj5, #form-field-idadeViaj6")
    
    for (var i = 0; i < idades.length; i++) {
            if (idades[i].value > 65) {
                maior65.push(idades[i].value)            
            } else if (idades[i].value > 0) {
                menor65.push(idades[i].value)
            } else {}
        }

    var viajantesMenor65 = menor65.length
    var viajantesMaior65 = maior65.length

    var valorFinal

    var planoEscolhido
    if (valorPlanoDia0 == true) {
        planoEscolhido = document.getElementById("form-field-plano-0").value
    } else if (valorPlanoDia1 == true) {
        planoEscolhido = document.getElementById("form-field-plano-1").value
    } else {}
    var planoComPonto = planoEscolhido.replace(",", ".")

    valorFinal = diasViagem*(cotacaoDolar*planoComPonto)*(viajantesMenor65 + viajantesMaior65*2)
    valorFinalReal = valorFinal.toLocaleString('pt-br', {style: 'currency', currency: 'BRL'})
    document.getElementById("valorfinal").innerHTML = valorFinalReal
    }

    function mostrarBotaoAssinar () {
        document.getElementById("btn-assinar").style.display = "block"
    }
},2000)

// Botão próxima etapa do cotador
var btnPlano
    window.setTimeout(function(){
    btnPlano = document.querySelector("#btn-plano")
    btnPlano.addEventListener("click", function(e){
        e.preventDefault
        escolherPlano()
    })

    document.getElementById("etapa1").style.display = "block"
    document.getElementById("etapa2").style.display = "none"

    function escolherPlano() {
        document.getElementById("etapa1").style.display = "none"
        document.getElementById("etapa2").style.display = "block"
    }
},2000)

// Botão voltar

var btnVoltar
    window.setTimeout(function(){
    btnVoltar = document.querySelector("#btn-voltar")
    btnVoltar.addEventListener("click", function(e){
        e.preventDefault
        escolherPlano()
    })

    function escolherPlano() {
        document.getElementById("etapa1").style.display = "block"
        document.getElementById("etapa2").style.display = "none"
    }
},2000)
</script>
    

home_url().'/cadastro-cotador/?dp='.$preOutput[$x]['qtd_dependentes'].'&pl='.$preOutput[$x]['ID'].'&pl_nm='.$preOutput[$x]['post_title'].'&op='.$preOutput[$x]['operadora'].'&prc='.$preOutput[$x]['preco'].'"target="_blank">