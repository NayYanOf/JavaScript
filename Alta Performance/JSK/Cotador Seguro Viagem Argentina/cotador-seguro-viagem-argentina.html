<script>
    // Função para puxar API CPF/CNPJ e aplicar nos campos de viajante
    function apiCpf(){
            jQuery(document).ready(function($) {
            var token = "589b919a78706e51e72c5f5e60c01046"
            var urlBase = "https://api.cpfcnpj.com.br/";
            $("#form-field-cpf_viajante1").blur(function() {
                var cpf = $("#form-field-cpf_viajante").val().replace(/\D/g, '');
                if (cpf != "") {
                    var validacpf = /^[0-9]{11}$/;      
                    if(validacpf.test(cpf)) {
                        $("#form-field-nome_viajante1").val("...");
                        $("#form-field-data_nasc").val("...");
                        $.getJSON(urlBase + token +"/7/" + cpf , function(data) { 
                            $( '#billing_persontype option[value=1]' ).attr( 'selected', 'selected' ).change();
                            $("#form-field-nome_viajante1").val(data.nome);
                            var nomeAPI = data.nome;
                            var nomeCompleto = nomeAPI.split(" ");
                            var primeiroNome = nomeCompleto[0];
                            var sobrenomeArray = nomeCompleto.slice(1);
                            var sobrenome = sobrenomeArray.join(" ");
                            $("#form-field-nome_viajante1").val(data.nome);
                            $("#billing_nome_viajante1").val(data.nome);
                            $("#form-field-data_nasc").val(data.nascimento);
                            $("#billing_nasc_viajante1").val(data.nascimento);
                            $("#billing_first_name").val(primeiroNome);
                            $("#billing_last_name").val(sobrenome);
                            $("#billing_cpf").val(cpf);
                            
                            $("#billing_cpf_viajante1").val(cpf);
                        });
                    };
                }
            });
        });
    }

    // Função para puxar API CEP e aplicar nos campos de viajante
    function apiCep(){
        var estado;
        jQuery(document).ready(function($) {
            $( '#billing_state option:selected' ).attr( 'selected', false ).change();
            var urlBase = "https://viacep.com.br/ws/";
            $("#form-field-cep_viajante").blur(function() {
                var cep = $("#form-field-cep_viajante1").val().replace(/\D/g, '');
                if (cep != "") {
                    var validacep = /^[0-9]{8}$/;      
                    if(validacep.test(cep)) {
                        $("#form-field-endereco").val("...");
                        $("#form-field-end_cidade").val("...");
                        $("#form-field-end_bairro").val("...");
                        $("#form-field-end_estado").val("...");
                        $("#billing_postcode").val(cep);
                        $("#billing_cep_imovel").val(cep);
                        $.getJSON(urlBase + cep +"/json/?callback=?" , function(data) {            
                            $("#form-field-endereco").val(data.logradouro);
                            $("#billing_address_1").val(data.logradouro);
                            $("#billing_endereco_imovel").val(data.logradouro);
                            $("#form-field-end_bairro").val(data.bairro);
                            $("#billing_neighborhood").val(data.bairro);
                            $("#billing_bairro_imovel").val(data.bairro);
                            $("#form-field-end_cidade").val(data.localidade);
                            $("#billing_city").val(data.localidade);
                            $("#billing_cidade_imovel").val(data.localidade);
                            $("#form-field-end_estado").val(data.uf);
                            $("#billing_estado_imovel").val(data.uf);
                            estado = data.uf;
                            document.getElementById('billing_state').value = estado;
                            $( '#billing_state option[value='+ data.uf +']' ).attr( 'selected', 'selected' ).change();
                            console.log(data.uf);
                            $( '#billing_state' ).trigger( 'liszt:updated' ).trigger( 'chosen:updated' );
                        });
                    };
                }
            });
        });
    }

    // Função para puxar API Cotador Dólar
    function apiDolar() {
        var urlBase = "https://economia.awesomeapi.com.br/last";
        var moedas = "USD-BRL";
        jQuery(document).ready(function($) {
            $.getJSON( urlBase + "/" + moedas , function(data) {
                    var valorDolar = data["USDBRL"]["ask"];
                    $("#form-field-valor_dolar").val(valorDolar);
                    var dolarTradado = valorDolar.substring(0, valorDolar.length - 2);
                    var dolarVirgula = dolarTradado.replace(/[.]/g, ',');
                    $("#form-field-valor_dolar_virgula").val(dolarVirgula);
                });
            });
    }

    // Função para calculo da tarifa final
    function calculaTarifaFinal(){

    var diasViagem = document.querySelector("#form-field-diasVigem").value
    var cotacaoDolar = document.querySelector("#form-field-valor_dolar").value
    var valorPlanoDia0 = document.querySelector("#form-field-plano-0").checked
    var valorPlanoDia1 = document.querySelector("#form-field-plano-1").checked
    
    const menor65 = []
    const maior65 = []
    var idades = document.querySelectorAll("#form-field-idadeViaj1, #form-field-idadeViaj2, #form-field-idadeViaj3, #form-field-idadeViaj4, #form-field-idadeViaj5, #form-field-idadeViaj6")
    var i = 0
    for (i; i < idades.length; i++) {
            if (i > 65) {
                maior65.push("+65")
            } else {
                menor65.push("-65")
            }
        }

    var valorFinal
    var valorFinalArr

    var planoEscolhido = (valorPlanoDia0 == true) ? document.querySelector("#form-field-plano-0").value:document.querySelector("#form-field-plano-1").value


    valorFinal = diasViagem*(cotacaoDolar*planoEscolhido)*(qtdViajantes0 + qtdViajantes65*2)
    valorFinalArr = valorFinal.toFixed(2)
    document.querySelector("#valorfinal").innerHTML = "R$ "+"Teste"
    }
</script>

///////////////////////////////////////////////////////////////////////////////////////////////
    <script>
    function datepicker_draw_nb_nights(){
        var $datepicker = jQuery("#ui-datepicker-div");
        setTimeout(function(){
            if(start_date != null && end_date != null){
                //var $qty_days_stay = jQuery("<div />", { class: "ui-datepicker-stay-duration" });
                qty_nights_stay = get_days_difference(timestamp_start_date, timestamp_end_date);
                //$qty_days_stay.text(qty_nights_stay + " Noites");
                //$qty_days_stay.appendTo($datepicker);
                $("#form-field-diasVigem").val(qty_nights_stay);
            }
        });
    } 
        
    function get_days_difference(start_date, end_date){
        return Math.floor(end_date - start_date) / (1000*60*60*24);
    }
    </script>
    
    